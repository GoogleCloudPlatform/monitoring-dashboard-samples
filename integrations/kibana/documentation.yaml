exporter_type: included
app_name_short: Kibana
app_name: {{app_name_short}}
app_site_name: Kibana
app_site_url: https://www.elastic.co/kibana/
exporter_name: the Kibana exporter
exporter_pkg_name: kibana-prometheus-exporter
exporter_repo_url: https://github.com/pjhampton/kibana-prometheus-exporter
additional_prereq_info: |
  {{app_name_short}} exposes Prometheus-format metrics when the [prometheus plugin](https://github.com/pjhampton/kibana-prometheus-exporter) 
  is installed. You can run the following checks to verify
  that {{app_name_short}} is exposing Prometheus-format metrics.

   *  To determine if {{exporter_name}} is exposing metrics, run the following command:

      <pre class="devsite-click-to-copy">
      kubectl -n <namespace_name> port-forward <kibana_pod_name> 5601
      curl localhost:5601/_prometheus/metrics
      </pre>
dashboard_available: true
multiple_dashboards: false
dashboard_display_name: {{app_name_short}} Prometheus Overview
podmonitoring_config: |
  apiVersion: monitoring.googleapis.com/v1
  kind: PodMonitoring
  metadata:
    name: kibana
    labels:
      app.kubernetes.io/name: kibana
      app.kubernetes.io/part-of: google-cloud-managed-prometheus
  spec:
    endpoints:
  + - port: 5601
      scheme: http
      interval: 30s
      path: /_prometheus/metrics
    selector:
      matchLabels:
  +     app.kubernetes.io/name: kibana
sample_promql_query: up{job="kibana", cluster="{{cluster_name}}", namespace="{{namespace_name}}"}
alerts_config: |
  apiVersion: monitoring.googleapis.com/v1
  kind: Rules
  metadata:
    name: kibana-rules
    labels:
      app.kubernetes.io/component: rules
      app.kubernetes.io/name: kibana-rules
      app.kubernetes.io/part-of: google-cloud-managed-prometheus
  spec:
    groups:
    - name: kibana
      interval: 30s
      rules:
      - alert: KibanaHighCPUUsage
        annotations:
          description: |-
            Kibana high cpu usage
              VALUE = {{ $value }}
              LABELS: {{ $labels }}
          summary: Kibana high cpu usage (instance {{ $labels.instance }})
        expr: kibana_os_load5 >= 90
        for: 5m
        labels:
          severity: critical
      - alert: KibanaHighMemoryUsage
        annotations:
          description: |-
            Kibana high memory usage
              VALUE = {{ $value }}
              LABELS: {{ $labels }}
          summary: Kibana high memory usage (instance {{ $labels.instance }})
        expr: kibana_os_mem_bytes_used / kibana_os_mem_bytes_total >= 0.9
        for: 5m
        labels:
          severity: critical
additional_alert_info: You can adjust the alert thresholds to suit your application.
