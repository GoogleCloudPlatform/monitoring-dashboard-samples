{
  "displayName": "High CPU Limit Utilization (GKE Workload: ${WORKLOAD_NAME})",
  "documentation": {
    "content": "[View Workload Details](https://console.cloud.google.com/kubernetes/deployment/${CLUSTER_LOCATION}/${CLUSTER_NAME}/${NAMESPACE}/${WORKLOAD_NAME}/observability?project=${PROJECT_ID}).\n- Workloads with high CPU limit utilization likely have containers that are CPU throttled. To avoid application slowdown and unresponsiveness, you can either keep CPU usage below the CPU limit or increase the limit [View Documentation](https://cloud.google.com/blog/products/containers-kubernetes/kubernetes-best-practices-resource-requests-and-limits)\n- If alerts tend to be false positive or noisy, consider visiting the alert policy page and changing the threshold, the rolling (alignment) window, and the retest (duration) window. [Alerting policies documentation](https://cloud.google.com/monitoring/alerts/concepts-indepth), [MQL documentation](https://cloud.google.com/monitoring/mql/alerts)",
    "mimeType": "text/markdown"
  },
  "userLabels": {},
  "conditions": [
    {
      "displayName": "CPU Limit Utilization is high for: ${WORKLOAD_NAME}",
      "conditionPrometheusQueryLanguage": {
        "duration": "0s",
        "evaluationInterval": "30s",
        "query": "(\n  sum(rate(\n    {\"kubernetes.io/container/cpu/core_usage_time\",\n    monitored_resource=\"k8s_container\",\n    top_level_controller_name=\"${WORKLOAD_NAME}\",\n    top_level_controller_type=\"${TOP_LEVEL_CONTROLLER_TYPE}\",\n    project_id=\"${PROJECT_ID}\",\n    cluster_name=\"${CLUSTER_NAME}\",\n    location=\"${CLUSTER_LOCATION}\",\n    namespace_name=\"${NAMESPACE}\"}[5m])\n  )\n  /\n  sum(avg_over_time(\n    {\"kubernetes.io/container/cpu/limit_cores\",\n    monitored_resource=\"k8s_container\",\n    top_level_controller_name=\"${WORKLOAD_NAME}\",\n    top_level_controller_type=\"${TOP_LEVEL_CONTROLLER_TYPE}\",\n    project_id=\"${PROJECT_ID}\",\n    cluster_name=\"${CLUSTER_NAME}\",\n    location=\"${CLUSTER_LOCATION}\",\n    namespace_name=\"${NAMESPACE}\"}[5m])\n  )\n)\n* on() group_left(p) label_replace(vector(1), \"p\", \"CPU Limit Utilization\", \"\", \"\")\n> 0.9"
      }
    }
  ],
  "alertStrategy": {
    "autoClose": "604800s",
    "notificationPrompts": [
      "OPENED",
      "CLOSED"
    ]
  },
  "combiner": "OR",
  "enabled": true,
  "notificationChannels": [],
  "severity": "SEVERITY_UNSPECIFIED"
}
